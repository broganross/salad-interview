package main

import (
	"net"
	"os"

	"github.com/rs/zerolog/log"
)

func main() {
	ln, err := net.Listen("tcp", ":5000")
	if err != nil {
		log.Error().Err(err).Msg("listening on :5000")
		os.Exit(1)
	}
	defer ln.Close()
	for {
		conn, err := ln.Accept()
		if err != nil {
			log.Error().Err(err).Msg("accepting connection")
			continue
		}
		go handleConnection(conn)
	}
}

func handleConnection(conn net.Conn) {
	// time.Sleep(1 * time.Minute)
	data := []byte{
		0x41, 0x49, 0x52, 0x00, 0x00, 0x00, 0x06, 0x4E, 0x32, 0x30, 0x39, 0x30, 0x34, 0x00, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, 0x07, 0x47, 0x45, 0x6E, 0x78, 0x2D, 0x31, 0x42, 0x40, 0x43, 0x8E, 0xD6,
		0xEB, 0xFF, 0x60, 0x1D, 0xC0, 0x50, 0xD4, 0xC0, 0x91, 0x63, 0x01, 0x65, 0x40, 0xE2, 0x03, 0xF0,
		0x00, 0x00, 0x00, 0x00, 0xC0, 0x4A, 0x99, 0x99, 0x99, 0x99, 0x99, 0x9A,
	}
	_, err := conn.Write(data)
	if err != nil {
		log.Error().Err(err).Msg("writing response")
	}
	conn.Close()
}
